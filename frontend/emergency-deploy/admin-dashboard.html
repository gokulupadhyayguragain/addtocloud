<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AddToCloud Enterprise Platform</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #7c2d12 50%, #0f172a 100%);
            color: white; 
            min-height: 100vh; 
        }
        .api-status {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #dc2626;
            color: white;
            text-align: center;
            padding: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .api-status.connected {
            background: #16a34a;
        }
        .api-status.connecting {
            background: #ca8a04;
        }
        body.has-api-status .nav {
            margin-top: 40px;
        }
        .nav { 
            background: rgba(15, 23, 42, 0.9); 
            backdrop-filter: blur(10px); 
            border-bottom: 1px solid rgba(124, 45, 18, 0.5); 
            padding: 1rem 2rem; 
        }
        .nav-content { 
            max-width: 1200px; 
            margin: 0 auto; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .logo { 
            font-size: 1.5rem; 
            font-weight: bold; 
            text-decoration: none; 
            color: white; 
        }
        .logo .blue { color: #f97316; }
        .nav-actions { 
            display: flex; 
            gap: 1rem; 
            align-items: center; 
        }
        .admin-badge { 
            background: rgba(124, 45, 18, 0.3); 
            border: 1px solid #f97316; 
            border-radius: 0.5rem; 
            padding: 0.25rem 0.75rem; 
            font-size: 0.75rem; 
            color: #fed7aa; 
        }
        .btn-logout { 
            background: #dc2626; 
            color: white; 
            border: none; 
            padding: 0.5rem 1rem; 
            border-radius: 0.5rem; 
            cursor: pointer; 
            font-size: 0.875rem; 
        }
        .btn-logout:hover { 
            background: #b91c1c; 
        }
        .container { 
            max-width: 1200px; 
            margin: 2rem auto; 
            padding: 0 2rem; 
        }
        .dashboard-header { 
            text-align: center; 
            margin-bottom: 3rem; 
        }
        .dashboard-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 2rem; 
            margin-bottom: 3rem; 
        }
        .card { 
            background: rgba(124, 45, 18, 0.2); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(124, 45, 18, 0.5); 
            border-radius: 1rem; 
            padding: 2rem; 
        }
        .card h3 { 
            margin-bottom: 1rem; 
            color: #f97316; 
        }
        .metric { 
            font-size: 2rem; 
            font-weight: bold; 
            margin-bottom: 0.5rem; 
        }
        .metric.users { color: #22d3ee; }
        .metric.services { color: #a855f7; }
        .metric.deployments { color: #22c55e; }
        .metric.requests { color: #eab308; }
        .requests-list { 
            background: rgba(15, 23, 42, 0.8); 
            border-radius: 1rem; 
            padding: 2rem; 
        }
        .request-item { 
            background: rgba(124, 45, 18, 0.2); 
            border: 1px solid rgba(124, 45, 18, 0.3); 
            border-radius: 0.75rem; 
            padding: 1.5rem; 
            margin-bottom: 1rem; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .request-info h4 { 
            margin-bottom: 0.5rem; 
        }
        .request-info p { 
            color: #94a3b8; 
            font-size: 0.875rem; 
        }
        .request-actions { 
            display: flex; 
            gap: 0.5rem; 
        }
        .btn { 
            padding: 0.5rem 1rem; 
            border-radius: 0.5rem; 
            border: none; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s; 
            font-size: 0.875rem; 
        }
        .btn-approve { 
            background: #22c55e; 
            color: white; 
        }
        .btn-approve:hover { 
            background: #16a34a; 
        }
        .btn-reject { 
            background: #dc2626; 
            color: white; 
        }
        .btn-reject:hover { 
            background: #b91c1c; 
        }
        .status-badge { 
            padding: 0.25rem 0.75rem; 
            border-radius: 0.5rem; 
            font-size: 0.75rem; 
            font-weight: 600; 
        }
        .status-pending { 
            background: rgba(234, 179, 8, 0.2); 
            color: #fde047; 
            border: 1px solid rgba(234, 179, 8, 0.3); 
        }
        .empty-state { 
            text-align: center; 
            color: #64748b; 
            padding: 3rem; 
        }
    </style>
</head>
<body class="has-api-status">
    <!-- API Status Indicator -->
    <div id="api-status" class="api-status connecting">
        üîó API Connection: Checking...
    </div>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-content">
            <a href="/index.html" class="logo">
                Add<span class="blue">To</span>Cloud
            </a>
            <div class="nav-actions">
                <div class="admin-badge">üîë ADMIN</div>
                <button class="btn-logout" onclick="logout()">
                    üö™ Logout
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="dashboard-header">
            <h1 style="font-size: 3rem; margin-bottom: 1rem;">Admin Dashboard</h1>
            <p style="color: #cbd5e1; font-size: 1.25rem;">
                Manage access requests and monitor platform activities
            </p>
        </div>

        <!-- Metrics Grid -->
        <div class="dashboard-grid">
            <div class="card">
                <h3>üë• Total Users</h3>
                <div class="metric users" id="totalUsers">Loading...</div>
                <p style="color: #64748b;">Registered platform users</p>
            </div>

            <div class="card">
                <h3>üõ†Ô∏è Active Services</h3>
                <div class="metric services" id="activeServices">Loading...</div>
                <p style="color: #64748b;">Running cloud services</p>
            </div>

            <div class="card">
                <h3>üöÄ Deployments</h3>
                <div class="metric deployments" id="totalDeployments">Loading...</div>
                <p style="color: #64748b;">Multi-cloud deployments</p>
            </div>

            <div class="card">
                <h3>üìã Pending Requests</h3>
                <div class="metric requests" id="pendingRequests">Loading...</div>
                <p style="color: #64748b;">Awaiting approval</p>
            </div>
        </div>

        <!-- Access Requests -->
        <div class="requests-list">
            <h2 style="margin-bottom: 2rem; color: #f97316;">üîê Access Requests</h2>
            
            <div id="requestsList">
                <!-- Requests will be loaded here -->
            </div>
            
            <div id="emptyState" class="empty-state" style="display: none;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
                <h3>No pending requests</h3>
                <p>All access requests have been processed</p>
            </div>
        </div>
    </div>

    <script>
        // Check admin authentication
        const adminToken = localStorage.getItem('adminToken');
        if (!adminToken) {
            window.location.href = '/admin-login.html';
        }

        // Mock data for demo
        const mockRequests = [
            {
                id: 1,
                name: "John Doe",
                email: "john.doe@company.com",
                company: "Tech Corp",
                serviceType: "PaaS - Container Platform",
                timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                status: "pending"
            },
            {
                id: 2,
                name: "Sarah Wilson",
                email: "s.wilson@startup.io",
                company: "StartupIO",
                serviceType: "FaaS - Serverless Functions",
                timestamp: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(),
                status: "pending"
            },
            {
                id: 3,
                name: "Mike Chen",
                email: "mike@enterprise.com",
                company: "Enterprise Solutions",
                serviceType: "IaaS - Virtual Machines",
                timestamp: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                status: "pending"
            }
        ];

        // Load dashboard data
        async function loadDashboard() {
            try {
                // Try to fetch real data
                const response = await fetch('/api/v1/admin/dashboard', {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    updateMetrics(data.metrics);
                    displayRequests(data.requests);
                } else {
                    throw new Error('Failed to load dashboard');
                }
            } catch (error) {
                console.log('Using demo data:', error);
                // Use mock data for demo
                updateMetrics({
                    totalUsers: 127,
                    activeServices: 23,
                    totalDeployments: 45,
                    pendingRequests: mockRequests.length
                });
                displayRequests(mockRequests);
            }
        }

        function updateMetrics(metrics) {
            document.getElementById('totalUsers').textContent = metrics.totalUsers || 0;
            document.getElementById('activeServices').textContent = metrics.activeServices || 0;
            document.getElementById('totalDeployments').textContent = metrics.totalDeployments || 0;
            document.getElementById('pendingRequests').textContent = metrics.pendingRequests || 0;
        }

        function displayRequests(requests) {
            const requestsList = document.getElementById('requestsList');
            const emptyState = document.getElementById('emptyState');

            if (!requests || requests.length === 0) {
                requestsList.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            requestsList.innerHTML = requests.map(request => `
                <div class="request-item" id="request-${request.id}">
                    <div class="request-info">
                        <h4>${request.name}</h4>
                        <p><strong>Email:</strong> ${request.email}</p>
                        <p><strong>Company:</strong> ${request.company}</p>
                        <p><strong>Service:</strong> ${request.serviceType}</p>
                        <p><strong>Requested:</strong> ${formatTimestamp(request.timestamp)}</p>
                        <span class="status-badge status-${request.status}">${request.status.toUpperCase()}</span>
                    </div>
                    <div class="request-actions">
                        <button class="btn btn-approve" onclick="approveRequest(${request.id})">
                            ‚úÖ Approve
                        </button>
                        <button class="btn btn-reject" onclick="rejectRequest(${request.id})">
                            ‚ùå Reject
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function approveRequest(requestId) {
            try {
                const response = await fetch(`/api/v1/admin/requests/${requestId}/approve`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    showNotification('Request approved successfully', 'success');
                    removeRequestFromList(requestId);
                } else {
                    throw new Error('Failed to approve request');
                }
            } catch (error) {
                console.log('Approval simulation:', error);
                showNotification('Request approved successfully (Demo)', 'success');
                removeRequestFromList(requestId);
            }
        }

        async function rejectRequest(requestId) {
            try {
                const response = await fetch(`/api/v1/admin/requests/${requestId}/reject`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    showNotification('Request rejected', 'error');
                    removeRequestFromList(requestId);
                } else {
                    throw new Error('Failed to reject request');
                }
            } catch (error) {
                console.log('Rejection simulation:', error);
                showNotification('Request rejected (Demo)', 'error');
                removeRequestFromList(requestId);
            }
        }

        function removeRequestFromList(requestId) {
            const requestElement = document.getElementById(`request-${requestId}`);
            if (requestElement) {
                requestElement.remove();
            }

            // Update pending requests count
            const currentCount = parseInt(document.getElementById('pendingRequests').textContent);
            document.getElementById('pendingRequests').textContent = Math.max(0, currentCount - 1);

            // Check if list is empty
            const requestsList = document.getElementById('requestsList');
            if (requestsList.children.length === 0) {
                document.getElementById('emptyState').style.display = 'block';
            }
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 2rem;
                right: 2rem;
                padding: 1rem 2rem;
                border-radius: 0.5rem;
                color: white;
                font-weight: 600;
                z-index: 1000;
                transition: all 0.3s;
                background: ${type === 'success' ? '#22c55e' : '#dc2626'};
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffHours / 24);

            if (diffHours < 1) {
                return 'Just now';
            } else if (diffHours < 24) {
                return `${diffHours} hours ago`;
            } else {
                return `${diffDays} days ago`;
            }
        }

        function logout() {
            localStorage.removeItem('adminToken');
            window.location.href = '/admin-login.html';
        }

        // Initialize dashboard
        loadDashboard();
    </script>
</body>
</html>
